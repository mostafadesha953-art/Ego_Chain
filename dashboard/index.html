<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>EgoChain Core | النظام السيادي الموحد</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com">
    <style>
        :root { --gold: #d4af37; --dark: #050505; --card: #121212; --green: #25d366; --danger: #ff4b2b; --blue: #007bff; }
        body { background: var(--dark); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 280px; background: var(--card); border-left: 1px solid #222; display: flex; flex-direction: column; padding: 20px; z-index: 100; }
        .nav-link { padding: 12px; margin: 5px 0; border-radius: 8px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; color: #888; font-size: 14px; border: 1px solid transparent; }
        .nav-link:hover, .nav-link.active { background: #1a1a1a; color: var(--gold); border-color: var(--gold); }
        .nav-link i { margin-left: 12px; width: 18px; }

        .auth-panel { background: #0a0a0a; padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 20px; }
        input, select, textarea { width: 100%; padding: 10px; margin: 5px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 6px; font-size: 12px; box-sizing: border-box; }
        .btn-sm { flex: 1; padding: 8px; font-size: 11px; font-weight: bold; border-radius: 5px; cursor: pointer; border: none; }

        .main-content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .viewport { display: none; }
        .viewport.active { display: block; }

        .card { background: var(--card); padding: 25px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; position: relative; }
        .stat-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px; }
        .asset-card { text-align: center; border-bottom: 3px solid var(--gold); }
        .asset-val { font-size: 22px; font-weight: bold; color: var(--gold); margin: 5px 0; }
        .asset-usdt { font-size: 12px; color: #888; }

        .btn-buy { padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; transition: 0.3s; color: #000; width: 100%; margin-top: 10px; }
        .btn-buy.aura { background: var(--gold); }
        .btn-buy.jewel { background: var(--green); }

        /* Toast Notifications */
        #toast-container { position: fixed; bottom: 20px; left: 20px; z-index: 10000; }
        .toast { background: #1a1a1a; color: #fff; padding: 12px 20px; border-radius: 8px; border-right: 4px solid var(--gold); margin-top: 10px; display: flex; align-items: center; gap: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); animation: slideIn 0.3s ease-out; font-size: 13px; }
        @keyframes slideIn { from { transform: translateX(-100%); } to { transform: translateX(0); } }

        #halt-screen { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:#000; z-index:9999; color:var(--danger); flex-direction:column; justify-content:center; align-items:center; text-align:center; }
    </style>
</head>
<body>

    <div id="toast-container"></div>
    <div id="halt-screen"><i class="fas fa-radiation fa-5x"></i><h1>NETWORK HALTED</h1><p>تم إيقاف العمليات لدواعي أمنية</p></div>

    <div class="sidebar">
        <div id="nav-home" class="nav-link active" onclick="showPage('home')"><i class="fas fa-home"></i> الرئيسية</div>

        <div class="auth-panel">
            <input type="text" id="auth-id" placeholder="البريد أو الهاتف">
            <input type="password" id="auth-pass" placeholder="الرقم السري">
            <input type="password" id="auth-key" placeholder="المفتاح السري (التوقيع)">
            <div style="display: flex; gap: 5px; margin-top: 10px;">
                <button class="btn-sm" style="background: var(--blue); color: #fff;" onclick="actionRegister()">إنشاء محفظة</button>
                <button class="btn-sm" style="background: var(--gold); color: #000;" onclick="actionLogin()">دخول</button>
            </div>
        </div>

        <div id="nav-wallet" class="nav-link" onclick="showPage('wallet')"><i class="fas fa-wallet"></i> محفظتي</div>
        <div id="nav-factory" class="nav-link" onclick="showPage('factory')"><i class="fas fa-microchip"></i> مصنع العقود</div>
        
        <button onclick="triggerHalt()" style="background:var(--danger); color:white; border:none; padding:10px; width:100%; border-radius:5px; cursor:pointer; margin-top: auto;">
            <i class="fas fa-power-off"></i> طوارئ
        </button>
    </div>

    <div class="main-content">
        <div id="page-home" class="viewport active">
            <div class="card" style="border-right: 4px solid var(--gold);">
                <h2>EgoChain Sovereign Core</h2>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div class="card asset-card">
                        <h4>Aura (AURA)</h4>
                        <div class="asset-val">0.63 USDT</div>
                        <button class="btn-buy aura" onclick="buyCurrency('AURA', 0.63)">شراء USDT</button>
                    </div>
                    <div class="card asset-card">
                        <h4>Jewel (JWL)</h4>
                        <div class="asset-val">0.45 USDT</div>
                        <button class="btn-buy jewel" onclick="buyCurrency('JEWEL', 0.45)">شراء USDT</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="page-wallet" class="viewport">
            <div class="card">
                <h3>أرصدة المحفظة</h3>
                <div class="stat-grid">
                    <div class="card asset-card"><small>AURA</small><div class="asset-val" id="ui-aura">0</div><div id="ui-aura-usdt" class="asset-usdt">0 USDT</div></div>
                    <div class="card asset-card"><small>JEWEL</small><div class="asset-val" id="ui-jewel">0</div><div id="ui-jewel-usdt" class="asset-usdt">0 USDT</div></div>
                    <div class="card asset-card"><small>USDT</small><div class="asset-val" id="ui-usdt">100.00</div></div>
                </div>
                <input type="text" id="send-to" placeholder="المستلم EGO_...">
                <input type="number" id="send-amt" placeholder="الكمية">
                <button class="btn-buy aura" onclick="sendAssets()">إرسال (توقيع 2.5%)</button>
            </div>
        </div>

        <div id="page-factory" class="viewport">
            <div class="card">
                <h3>إنشاء عقد ذكي</h3>
                <input type="text" id="c-name" placeholder="اسم العقد">
                <textarea id="c-display" style="height:100px;" readonly placeholder="كود العقد..."></textarea>
                <button class="btn-buy jewel" onclick="generateContract()">توليد وتوقيع</button>
            </div>
        </div>
    </div>

    <script>
        // محرك الربط
        let messenger = {
            send: function(ch, data) {
                if (window.require) {
                    const { ipcRenderer } = window.require('electron');
                    ipcRenderer.send(ch, data);
                }
            }
        };

        let myBalances = { AURA: 1000, JEWEL: 5000, USDT: 100.00 };
        const PRICES = { AURA: 0.63, JEWEL: 0.45 };

        function showToast(msg, color = '#d4af37') {
            const container = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = 'toast';
            t.style.borderRightColor = color;
            t.innerHTML = <i class="fas fa-info-circle"></i> ${msg};
            container.appendChild(t);
            setTimeout(() => t.remove(), 3500);
        }

        function showPage(p) {
            document.querySelectorAll('.viewport').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            document.getElementById('page-' + p).classList.add('active');
            document.getElementById('nav-' + p).classList.add('active');
        }

        function updateUI() {
            document.getElementById('ui-aura').innerText = myBalances.AURA.toLocaleString();
            document.getElementById('ui-jewel').innerText = myBalances.JEWEL.toLocaleString();
            document.getElementById('ui-usdt').innerText = myBalances.USDT.toFixed(2);
            document.getElementById('ui-aura-usdt').innerText = (myBalances.AURA * PRICES.AURA).toFixed(2) + " USDT";
            document.getElementById('ui-jewel-usdt').innerText = (myBalances.JEWEL * PRICES.JEWEL).toFixed(2) + " USDT";
        }

        function buyCurrency(asset, p) {
            let amt = prompt(كمية ${asset}:);
            if(!amt || isNaN(amt)) return;
            let cost = amt * p;
            if(myBalances.USDT < cost) return showToast("رصيد USDT غير كافٍ!", "#ff4b2b");
            myBalances.USDT -= cost;
            myBalances[asset] += parseFloat(amt);
            updateUI();
            showToast(تم شراء ${amt} ${asset} بنجاح!, "#25d366");
            messenger.send('initiate-buy', { asset, amt, cost });
        }

        function sendAssets() {
            let amt = document.getElementById('send-amt').value;
            let key = document.getElementById('auth-key').value;
            if(!amt || !key) return showToast("المفتاح والكمية مطلوبان!", "#ff4b2b");
            let tax = (amt * 0.025).toFixed(4);
            showToast(تم التوقيع. الرسوم: ${tax}, "#25d366");
            messenger.send('initiate-transfer', { amt, tax });
        }

        function generateContract() {
            let n = document.getElementById('c-name').value;
            let k = document.getElementById('auth-key').value;
            if(!n || !k) return showToast("الاسم والمفتاح مطلوبان!", "#ff4b2b");
            let sc = { id: Date.now(), name: n, signature: btoa(k) };
            document.getElementById('c-display').value = JSON.stringify(sc, null, 2);
            showToast("تم توليد العقد وتوقيعه.");
        }

        function actionLogin() { showToast("تم تسجيل الدخول ✓"); updateUI(); }
        function actionRegister() { showToast("تم إنشاء المحفظة بنجاح."); }
        function triggerHalt() { if(confirm("إيقاف؟")) showToast("إرسال إشارة الإيقاف..."); }

        window.onload = updateUI;
    </script>
</body>
</html>
